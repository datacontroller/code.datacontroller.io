<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- HTML header for doxygen 1.8.17-->
<html xmlns="https://www.w3.org/1999/xhtml" lang="en">
<head>
  <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=9" />
  <meta name="generator" content="Doxygen 1.9.3" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Data Controller: sasjs/macros/bitemporal_dataloader.sas File Reference</title>
  <link href="tabs.css" rel="stylesheet" type="text/css" />
  <script type="text/javascript" src="jquery.js"></script>
  <script type="text/javascript" src="dynsections.js"></script>
  <link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
 <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script> 
  <link href="doxygen.css" rel="stylesheet" type="text/css" />
  <link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
  <link href="new_stylesheet.css" rel="stylesheet" type="text/css"/>
  <!-- Matomo -->
  <script>
    var _paq = window._paq = window._paq || [];
    /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
    _paq.push(['trackPageView']);
    _paq.push(['enableLinkTracking']);
    (function () {
      var u = "https://analytics.4gl.io/";
      _paq.push(['setTrackerUrl', u + 'matomo.php']);
      _paq.push(['setSiteId', '11']);
      var d = document, g = d.createElement('script'), s = d.getElementsByTagName('script')[0];
      g.async = true; g.src = u + 'matomo.js'; s.parentNode.insertBefore(g, s);
    })();
  </script>
  <!-- End Matomo Code -->
</head>
<body>
  <div id="top">
    <!-- do not remove this div, it is closed by doxygen! -->
    <div id="titlearea">
      <table cellspacing="0" cellpadding="0">
        <tbody>
          <tr style="height: 56px">
            <td id="projectlogo">
              <a href=""><img alt="Logo" src="data_controller.png" /></a>
            </td>
            <td id="projectalign" style="padding-left: 0.5em">
              <div id="projectname">
              </div>
              <div id="projectbrief">
                Data Controller<br />
                <a href="https://code.datacontroller.io">
                  https://code.datacontroller.io
                </a>
              </div>
              <meta name="Description" content="Data Controller Source Files" />
            </td>
            <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
          </tr>
        </tbody>
      </table>
    </div>
    <!-- end header part -->
  </div>
</body>
</html>
<!-- Generated by Doxygen 1.9.3 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('bitemporal__dataloader_8sas.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle"><div class="title">bitemporal_dataloader.sas File Reference</div></div>
</div><!--header-->
<div class="contents">

<p>Routine supporting multiple load types.  
<a href="#details">More...</a></p>

<p><a href="bitemporal__dataloader_8sas_source.html">Go to the source code of this file.</a></p>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p >This macro will add a correctly prepared staging table to a BiTemporal base table. The staging table should have a unique business key (macro has not been tested for loading PKs with a business temporal history)</p>
<p >ASSUMPTIONS:</p><ul>
<li>Base table has relevant datetime vars: 2xTechnical, 2xBusiness, 1xProcessed</li>
<li>Staging table omits Technical or Processed datetimes (has Business only)</li>
<li>Base table has no column names containing the string "___TMP___"</li>
<li>Base &amp;tech_from variable is not nullable. This should always be the case anyway whenbuilding permanent bitemporal datasets.. But the point is that this field is used to identify new records after the initial left join from staging to base table.</li>
</ul>
<p >NOTES:</p><ul>
<li>All queries against BiTemporal tables need two filter conditions, as such: <pre class="fragment">where &amp;bus_from LE [tstamp] LT &amp;bus_to
  AND &amp;tx_from LE [tstamp] LT &amp;tx_to
</pre> One cannot use BETWEEN One cannot use &amp;xx_from LE [tstamp] LE &amp;xx_from (equivalent to above). Background: <a href="http://stackoverflow.com/questions/20005950/best-practice-for-scd-date-pairs-closing-opening-timestamps">http://stackoverflow.com/questions/20005950/best-practice-for-scd-date-pairs-closing-opening-timestamps</a></li>
</ul>
<p >Areas for optimisation</p><ul>
<li>loading temporal history (currently experimental)</li>
</ul>
<h4>Global Variables  The following global macro variables are used. These should be replaced by macro parameters in future releases.  @li <code>dc_dttmtfmt</code>   SAS Macros </h4>
<ul>
<li><a class="el" href="bitemporal__closeouts_8sas.html" title="Closes out records.">bitemporal_closeouts.sas</a> </li>
<li>dc_assignlib.sas </li>
<li><a class="el" href="mf__existvar_8sas.html" title="Checks if a variable exists in a data set.">mf_existvar.sas</a> </li>
<li><a class="el" href="mf__fmtdttm_8sas.html" title="Returns E8601DT26.6 if compatible else DATETIME19.3.">mf_fmtdttm.sas</a> </li>
<li><a class="el" href="mf__getattrn_8sas.html" title="Returns a numeric attribute of a dataset.">mf_getattrn.sas</a> </li>
<li><a class="el" href="mf__getengine_8sas.html" title="Returns the engine type of a SAS library.">mf_getengine.sas</a> </li>
<li><a class="el" href="mf__getschema_8sas.html" title="Returns the database schema of a SAS library.">mf_getschema.sas</a> </li>
<li><a class="el" href="mf__getuniquename_8sas.html" title="Returns a shortened (32 char) GUID as a valid SAS name.">mf_getuniquename.sas</a> </li>
<li><a class="el" href="mf__getuser_8sas.html" title="Returns a userid according to session context.">mf_getuser.sas</a> </li>
<li><a class="el" href="mf__getvarlist_8sas.html" title="Returns dataset variable list direct from header.">mf_getvarlist.sas</a> </li>
<li><a class="el" href="mf__verifymacvars_8sas.html" title="Checks if a set of macro variables exist AND contain values.">mf_verifymacvars.sas</a> </li>
<li><a class="el" href="mf__wordsinstr1butnotstr2_8sas.html" title="Returns words that are in string 1 but not in string 2.">mf_wordsinstr1butnotstr2.sas</a> </li>
<li><a class="el" href="mp__abort_8sas.html" title="abort gracefully according to context">mp_abort.sas</a> </li>
<li><a class="el" href="mp__dropmembers_8sas.html" title="Drops tables / views (if they exist) without warnings in the log.">mp_dropmembers.sas</a> </li>
<li><a class="el" href="mp__lockanytable_8sas.html" title="Mechanism for locking tables to prevent parallel modifications.">mp_lockanytable.sas</a> </li>
<li><a class="el" href="mp__lockfilecheck_8sas.html" title="Aborts if a SAS lock file is in place, or if one cannot be applied.">mp_lockfilecheck.sas</a> </li>
<li><a class="el" href="mp__retainedkey_8sas.html" title="Generate and apply retained key values to a staging table.">mp_retainedkey.sas</a> </li>
<li><a class="el" href="mp__storediffs_8sas.html" title="Converts deletes/changes/appends into a single audit table.">mp_storediffs.sas</a></li>
</ul>
<h2><a class="anchor" id="autotoc_md12"></a>
Supporting tables</h2>
<p >Supporting tables must exist in the library specified in the <code>dclib</code> param.</p>
<h3><a class="anchor" id="autotoc_md13"></a>
MPE_DATALOADS</h3>
<p >This table is updated every time a successful load occurs, and includes information such as:</p>
<ul>
<li>library </li>
<li>dataset </li>
<li>message (supplied in the ETLSOURCE param) </li>
<li>new rows </li>
<li>deleted rows </li>
<li>changed rows </li>
<li>timestamp </li>
<li>the user making the load </li>
<li>the version of (this) macro used to make the load</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">APPEND_DSN=</td><td>(APPENDTABLE) Name of STAGING table </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">CONFIG_TABLE=</td><td>(&amp;dclib..MPE_CONFIG) The table containing library engine specific config. The following scopes are supported: <ul>
<li>DCBL_REDSH </li>
</ul>
</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">LOADTYPE=</td><td>(BITEMPORAL) Supported types: <ul>
<li>TXTEMPORAL - loads a buskey with version times </li>
<li>BUSTEMPORAL - loads buskey with bus + ver times </li>
<li>UPDATE - updates a buskey with NO history </li>
</ul>
</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">PROCESSED=</td><td>(0) This column obtains a current timestamp for changed records when loading the target table. Default is 0 (not set). If the target table contains a variable called PROCESSED_DTTM, and processed=0, then this column will be used for applying the current timestamp. </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">RK_MAXKEYTABLE=</td><td>(mpe_maxkeyvalues) The maxkeytable to use (must exist in DCLIB) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">PK=</td><td>Business key, space separated. Should NOT include temporal fields. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">RK_UNDERLYING=</td><td>If supplied will generate an RK based on these (space separated) business key fields. In this case only ONE PK field should be supplied, which is assumed to be the RK. The RK field, plus underlying fields, should all exist on the base table. The underlying fields should exist on the staging table (the RK / PK field will be overwritten). The staging table should also be unique on its PK.</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">dclib=</td><td>(&amp;dc_libref) The library containing DC configuration tables </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">outds_del=</td><td>(work.outds_del) Output table containing deleted records </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">outds_add=</td><td>(work.outds_add) Output table containing appended records </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">outds_mod=</td><td>(work.outds_mod) Output table containing changed records </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">outds_audit=</td><td>(0) Load detailed changes to an audit table. Uses the <a class="el" href="mp__storediffs_8sas.html" title="Converts deletes/changes/appends into a single audit table.">mp_storediffs.sas</a> macro. Provide the base table here, to load.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section version"><dt>Version</dt><dd>9.3 </dd></dl>
<dl class="section author"><dt>Author</dt><dd>Allan Bowe </dd></dl>
<dl class="section copyright"><dt>Copyright</dt><dd>4GL Apps Ltd - this is a licensed product and is NOT FOR RESALE OR DISTRIBUTION.</dd></dl>
<dl class="section warning"><dt>Warning</dt><dd>multitemporal loads (bitemporal for multiple points in time) are in experimental stage </dd></dl>

<p class="definition">Definition in file <a class="el" href="bitemporal__dataloader_8sas_source.html">bitemporal_dataloader.sas</a>.</p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.17-->
<!-- start footer part -->
<div id="nav-path" class="navpath">
  <!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_cfc38a21734c3edb6bc9dd88c6d4c406.html">sasjs</a></li><li class="navelem"><a class="el" href="dir_28cd64f980436b9184807de48c3cf4aa.html">macros</a></li><li class="navelem"><a class="el" href="bitemporal__dataloader_8sas.html">bitemporal_dataloader.sas</a></li>
    <li class="footer">
      Generated by
      <a href="https://www.doxygen.org/index.html">
        <img class="footer" src="doxygen.png" alt="doxygen" /></a>
      1.9.3
    </li>
    <li>
      <i> For more information visit the </i>
      <a href="https://docs.datacontroller.io">Docs Website</a>.
    </li>
  </ul>
</div>
